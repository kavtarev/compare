Что такое мониторинг?
это система контроля за предметами, организациями или чем угодно еще, что нас интересует

чтобы построить такую систему нам нужно решить 3 проблемы

откуда брать:
  сущности, которые мы мониторим
  правила по которым мы мониторим
  информацию для этих правил и результаты


поэтому было принято решение разбить систему на 3 сервиса,
каждый из которых решает одну из этих проблем.

# Откуда брать - сервис реджистри (кхд, ехд).

Сервис интегрируется с различными внешними системами. На данный момент 1с, контур-фокус
в дальнейшем планируется интеграция с crm каркад, гпба.

какие сущности в нем есть сейчас?
- Договоры лизинга, предметы, лизингополучатели, лизингодателя, контакты, НИЛ

Как это работает сейчас. Из 1с системы к нам присылается информация по текущим сущностям внутри 1с
это либо новые сущности либо обновленная информация по присланным ранее

Как это работает?
По кроне раз в х минут мы делаем запрос в 1с на эндпоинт,
по которому нам отдается новая информация по сущностям.
После получения ответа сущности парсятся и сохраняются в бд.
По сущностям контрагентов для обогащения данных делается запрос в контур-фокус

После этого в 1с отправляются id сохраненных сущностей, чтобы подтвердить получение.
нужно это затем чтобы при следующем запросе эти сущности не пришли к нам в ответе от 1с,
если по ним не было изменений. По сути это ретрай разнесенный по времени.

Реджистри - это просто хранилище данных.

После получения новых/изменных данных они отправляются в сервис мониторинг.
Отправляются не все данные а только минимально необходимы набор. Отправляются через рэббит.


# правила игры - сервис мониторинг

из реджистри в него прилетает минимально необходимый набор полей и сущностей для работы
это какая-то информация по предметам лизинга, что брали, кто брал, кто давал, какой договор и тд

На данный момент мониторятся только предметы лизинга. Что это значит? Тут 2 вопроса. Кто попадает на мониторинг и что за правила игры.

кто попадает?
- предметы лизинга, удовлетворяющие набору требований. У нах должен быть правильный тип, например мы не хотим мониторить стулья или пароходы (об этом будет позже). Они должны быть в лизинге сейчас и было бы хорошо чтобы они не были удалены

правила игры?
Кто знает/слышал про скоринг - тому все понятно. Это маркеры. В нашей системе они называются риск-индикаторы. Это сущности которые создаются пользователями и представляют собой проверки, которые пользователь хочет производить. Например - не находится ли ПЛ в СКФО. Или скажем по договору лизинга предмет должен быть в омске - там ли он? Выходит ли он на связь.

# 